server:
  port: 8080 # 后端服务端口

# Spring 配置
spring:
  datasource:
    driver-class-name: com.mysql.cj.jdbc.Driver
    url: jdbc:mysql://localhost:3306/shiyou?useUnicode=true&characterEncoding=utf8&serverTimezone=Asia/Shanghai&useSSL=false&allowPublicKeyRetrieval=true
    username: ${DB_USERNAME:root}  # ✅ 修复：从环境变量读取，默认值为 root
    password: Xinji200412@     # ✅ 修复：从环境变量读取，避免明文密码

  # ✅ Redis 配置已暂时禁用，后续需要时再启用
  # data:
  #   redis:
  #     host: ${REDIS_HOST:localhost}
  #     port: ${REDIS_PORT:6379}
  #     password: ${REDIS_PASSWORD:}
  #     database: 0
  #     timeout: 5000ms
  #     lettuce:
  #       pool:
  #         max-active: 8
  #         max-wait: -1ms
  #         max-idle: 8
  #         min-idle: 0

  servlet:
    multipart:
      max-file-size: 1GB # 单个文件最大1GB
      max-request-size: 1GB # 单次请求最大1GB

  main:
    allow-bean-definition-overriding: false # 禁止Bean重复定义

# JWT 配置
jwt:
  secret: ShiYouBackendSecretKey2025!@#$%ThisIsAVeryLongAndSecureSecretKeyForHS512Algorithm1234567890 # 用于签名的密钥
  expire: 86400000  # Token有效期：24小时（24小时 × 3600秒 × 1000毫秒 = 86400000毫秒）
  exclude-urls: /api/user/login,/api/user/register,/api/video/list,/api/video/detail/**,/api/search,/error
  enabled: true  # ✅ 修复：启用 JWT 认证（生产环境必须启用）

# 日志配置
logging:
  level:
    root: INFO
    com.temimi: DEBUG
    com.temimi.mapper: DEBUG # 打印Mapper层SQL日志
    org.springframework.web: INFO
    org.springframework.security: DEBUG
    org.mybatis: DEBUG
  pattern:
    console: '%d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] %-5level %logger{36} - %msg%n'
    file: '%d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] %-5level %logger{36} - %msg%n'
  file:
    name: logs/temimi-backend.log
    max-size: 100MB
    max-history: 30

# MyBatis-Plus 配置（纯注解方式）
mybatis-plus:
  configuration:
    map-underscore-to-camel-case: true
    log-impl: org.apache.ibatis.logging.slf4j.Slf4jImpl
    cache-enabled: true
    lazy-loading-enabled: true
    aggressive-lazy-loading: false
  global-config:
    db-config:
      id-type: auto
      # 如果不使用逻辑删除，可以注释掉以下配置
      # logic-delete-field: isDeleted
      # logic-delete-value: 1
      # logic-not-delete-value: 0
  mapper-locations: classpath*:mapper/**/*.xml

# 阿里云OSS 配置 - ✅ 修复：使用环境变量
aliyun:
  oss:
    endpoint: ${OSS_ENDPOINT:oss-cn-beijing.aliyuncs.com}       # ✅ 从环境变量读取
    accessKeyId: ${OSS_ACCESS_KEY_ID:}                           # ✅ 从环境变量读取
    accessKeySecret: ${OSS_ACCESS_KEY_SECRET:}                   # ✅ 从环境变量读取
    bucketName: ${OSS_BUCKET_NAME:temimi-bucket}                 # ✅ 从环境变量读取

# 文件上传配置
file:
  upload:
    path: D:/shiyou_upload/ # 文件上传根目录

# 视频上传限制配置
upload:
  video:
    max-size: 1073741824 # 视频文件最大1GB (1024 * 1024 * 1024)
  cover:
    max-size: 5242880 # 封面图片最大5MB (5 * 1024 * 1024)

# 管理端点配置
management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics
  endpoint:
    health:
      show-details: when-authorized
